<#
    .SYNOPSIS
    Force-creates a scheduled task that fires upon login of any user.
    It then tries to discover the Onedrive folder of the logged in user.
    If none is found, it will keep trying for the duration of the session with a slowly increasing interval.
    If Onedrive is discovered, a drivemapping to it will be (re)created using the driveletter O

    To decode / recode base64, use https://www.base64encode.org/ and select UTF-16LE as encoding type.

    .NOTES
    author: Jos Lieben / jos@lieben.nu
    copyright: https://www.lieben.nu/liebensraum/commercial-use/ (Commercial (re)use not allowed without prior written consent by the author, otherwise free to use/modify as long as header are kept intact)
    site: https://www.lieben.nu
    Created: 04/07/2023
#>
$taskName = "LC_INSTALLODRIVE"
$SchedService = New-Object –comobject 'Schedule.Service'
$SchedService.Connect()

$Task = $SchedService.NewTask(0)
$Task.RegistrationInfo.Description = $taskName
$Task.Settings.Enabled = $true
$Task.Settings.AllowDemandStart = $true

$trigger = $task.triggers.Create(9)
$trigger.Enabled = $true

$action = $Task.Actions.Create(0)
$action.Path = 'PowerShell.exe'
$action.Arguments = '-WindowStyle hidden -ex bypass -EncodedCommand PAAjAA0ACgAgACAAIAAgAC4AUwBZAE4ATwBQAFMASQBTAA0ACgAgACAAIAAgAFQAcgBpAGUAcwAgAHQAbwAgAGQAaQBzAGMAbwB2AGUAcgAgAHQAaABlACAATwBuAGUAZAByAGkAdgBlACAAZgBvAGwAZABlAHIAIABvAGYAIAB0AGgAZQAgAGwAbwBnAGcAZQBkACAAaQBuACAAdQBzAGUAcgAuAA0ACgAgACAAIAAgAEkAZgAgAG4AbwBuAGUAIABpAHMAIABmAG8AdQBuAGQALAAgAGkAdAAgAHcAaQBsAGwAIABrAGUAZQBwACAAdAByAHkAaQBuAGcAIABmAG8AcgAgAHQAaABlACAAZAB1AHIAYQB0AGkAbwBuACAAbwBmACAAdABoAGUAIABzAGUAcwBzAGkAbwBuACAAdwBpAHQAaAAgAGEAIABzAGwAbwB3AGwAeQAgAGkAbgBjAHIAZQBhAHMAaQBuAGcAIABpAG4AdABlAHIAdgBhAGwALgANAAoAIAAgACAAIABJAGYAIABPAG4AZQBkAHIAaQB2AGUAIABpAHMAIABkAGkAcwBjAG8AdgBlAHIAZQBkACwAIABhACAAZAByAGkAdgBlAG0AYQBwAHAAaQBuAGcAIAB0AG8AIABpAHQAIAB3AGkAbABsACAAYgBlACAAYwByAGUAYQB0AGUAZAAgAHUAcwBpAG4AZwAgAHQAaABlACAAZAByAGkAdgBlAGwAZQB0AHQAZQByACAATwANAAoADQAKACAAIAAgACAALgBOAE8AVABFAFMADQAKACAAIAAgACAAYQB1AHQAaABvAHIAOgAgAEoAbwBzACAATABpAGUAYgBlAG4AIAAvACAAagBvAHMAQABsAGkAZQBiAGUAbgAuAG4AdQANAAoAIAAgACAAIABjAG8AcAB5AHIAaQBnAGgAdAA6ACAATABpAGUAYgBlAG4AIABDAG8AbgBzAHUAbAB0AGEAbgBjAHkALAAgAHAAZQByAHAAZQB0AHUAYQBsACAAdQBuAGwAaQBtAGkAdABlAGQAIAB1AHMAZQAgAGYAbwByACAAQQBoAG8AbABkACAARABlAGwAaABhAGkAegBlAA0ACgAgACAAIAAgAHMAaQB0AGUAOgAgAGgAdAB0AHAAcwA6AC8ALwB3AHcAdwAuAGwAaQBlAGIAZQBuAC4AbgB1AA0ACgAgACAAIAAgAEMAcgBlAGEAdABlAGQAOgAgADAANAAvADAANwAvADIAMAAyADMADQAKACMAPgANAAoADQAKAEYAdQBuAGMAdABpAG8AbgAgAFcAcgBpAHQAZQAtAEwAbwBnAHsADQAKACAAIAAgACAAJABwAGEAdABoACAAPQAgAEoAbwBpAG4ALQBQAGEAdABoACAAJABFAE4AVgA6AFQARQBNAFAAIAAtAEMAaABpAGwAZABQAGEAdABoACAAIgBvAG0AYQBwAHAAaQBuAGcALgBsAG8AZwAiAA0ACgAgACAAIAAgAEEAZABkAC0AQwBvAG4AdABlAG4AdAAgACQAcABhAHQAaAAgAC0AVgBhAGwAdQBlACAAJABhAHIAZwBzAFsAMABdAA0ACgB9AA0ACgANAAoAJAByAGUAdAByAHkAQQBmAHQAZQByAFMAZQBjAG8AbgBkAHMAIAA9ACAAMQANAAoAdwBoAGkAbABlACgAJAB0AHIAdQBlACkAewANAAoAIAAgACAAIAAkAG8AbgBlAGQAcgBpAHYAZQBGAG8AbABkAGUAcgAgAD0AIAAkAE4AdQBsAGwAOwAgACQAbwBuAGUAZAByAGkAdgBlAEYAbwBsAGQAZQByACAAPQAgAEcAZQB0AC0AQwBoAGkAbABkAEkAdABlAG0AIAAtAFAAYQB0AGgAIAAkAGUAbgB2ADoAdQBzAGUAcgBwAHIAbwBmAGkAbABlACAALQBGAGkAbAB0AGUAcgAgACIAKgBPAG4AZQBkAHIAaQB2AGUAIAAtACAAKgAiAA0ACgAgACAAIAAgAGkAZgAoACQAbwBuAGUAZAByAGkAdgBlAEYAbwBsAGQAZQByACkAewANAAoAIAAgACAAIAAgACAAIAAgAFcAcgBpAHQAZQAtAEwAbwBnACAAIgBEAGUAdABlAGMAdABlAGQAIAB1AHMAZQByACAATwBuAGUAZAByAGkAdgBlACAAZgBvAGwAZABlAHIAIQAgAEMAcgBlAGEAdABpAG4AZwAgAG0AYQBwAHAAaQBuAGcAIAB0AG8AIABPAC0AZAByAGkAdgBlAC4ALgAuAC4AIgANAAoAIAAgACAAIAAgACAAIAAgACQAdABhAHIAZwBlAHQATABvAGMAYQB0AGkAbwBuACAAPQAgACQATgB1AGwAbAA7ACAAJAB0AGEAcgBnAGUAdABMAG8AYwBhAHQAaQBvAG4AIAA9ACAAIgAkACgAKAAkAG8AbgBlAGQAcgBpAHYAZQBGAG8AbABkAGUAcgAuAEYAdQBsAGwATgBhAG0AZQApAC4AUgBlAHAAbABhAGMAZQAoACIALwAiACwAIgBcACIAKQAuAFIAZQBwAGwAYQBjAGUAKAAiAEMAOgAiACwAIgBcAFwAbABvAGMAYQBsAGgAbwBzAHQAXABjACQAIgApACkAIgANAAoAIAAgACAAIAAgACAAIAAgACQAYwB1AHIAcgBlAG4AdABNAGEAcABwAGkAbgBnACAAPQAgACQATgB1AGwAbAA7ACAAJABjAHUAcgByAGUAbgB0AE0AYQBwAHAAaQBuAGcAIAA9ACAAZwBlAHQALQBwAHMAZAByAGkAdgBlACAALQBOAGEAbQBlACAATwANAAoAIAAgACAAIAAgACAAIAAgAGkAZgAoACQAYwB1AHIAcgBlAG4AdABNAGEAcABwAGkAbgBnACAALQBhAG4AZAAgACQAYwB1AHIAcgBlAG4AdABNAGEAcABwAGkAbgBnAC4ARABpAHMAcABsAGEAeQBSAG8AbwB0ACAALQBuAGUAIAAkAHQAYQByAGcAZQB0AEwAbwBjAGEAdABpAG8AbgApAHsADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgAFcAcgBpAHQAZQAtAEwAbwBnACAAIgBPADoAIABhAGwAcgBlAGEAZAB5ACAAbQBhAHAAcABlAGQAIABiAHUAdAAgAHQAbwAgAHcAcgBvAG4AZwAgAGwAbwBjAGEAdABpAG8AbgAgACgAJAAoACQAYwB1AHIAcgBlAG4AdABNAGEAcABwAGkAbgBnAC4ARABpAHMAcABsAGEAeQBSAG8AbwB0ACkAKQAgAHIAZQBtAG8AdgBpAG4AZwAgAGEAbgBkACAAcgBlAG0AYQBwAHAAaQBuAGcALgAuAC4AIgANAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAUgBlAG0AbwB2AGUALQBQAFMARAByAGkAdgBlACAALQBOAGEAbQBlACAATwAgAC0AQwBvAG4AZgBpAHIAbQA6ACQARgBhAGwAcwBlACAALQBGAG8AcgBjAGUAIAAtAEUAcgByAG8AcgBBAGMAdABpAG8AbgAgAFMAaQBsAGUAbgB0AGwAeQBDAG8AbgB0AGkAbgB1AGUADQAKACAAIAAgACAAIAAgACAAIAB9AGUAbABzAGUAaQBmACgAJABjAHUAcgByAGUAbgB0AE0AYQBwAHAAaQBuAGcAIAAtAGEAbgBkACAAJABjAHUAcgByAGUAbgB0AE0AYQBwAHAAaQBuAGcALgBEAGkAcwBwAGwAYQB5AFIAbwBvAHQAIAAtAGUAcQAgACQAdABhAHIAZwBlAHQATABvAGMAYQB0AGkAbwBuACkAewANAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAVwByAGkAdABlAC0ATABvAGcAIAAiAE8AOgAgAGkAcwAgAGEAbAByAGUAYQBkAHkAIABjAG8AcgByAGUAYwB0AGwAeQAgAG0AYQBwAHAAZQBkACwAIABuAG8AIABuAGUAZQBkACAAdABvACAAcgBlAG0AYQBwACEAIgANAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAYgByAGUAYQBrAA0ACgAgACAAIAAgACAAIAAgACAAfQANAAoAIAAgACAAIAAgACAAIAAgAHQAcgB5AHsADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgAE4AZQB3AC0AUABTAEQAcgBpAHYAZQAgAC0ATgBhAG0AZQAgAE8AIAAtAFAAUwBQAHIAbwB2AGkAZABlAHIAIABGAGkAbABlAFMAeQBzAHQAZQBtACAALQBSAG8AbwB0ACAAJAB0AGEAcgBnAGUAdABMAG8AYwBhAHQAaQBvAG4AIAAtAEQAZQBzAGMAcgBpAHAAdABpAG8AbgAgACIATwBuAGUAZAByAGkAdgBlACIAIAAtAFAAZQByAHMAaQBzAHQAIAAtAEMAbwBuAGYAaQByAG0AOgAkAEYAYQBsAHMAZQANAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAVwByAGkAdABlAC0ATABvAGcAIAAiAE0AYQBwAHAAZQBkACAAJAB0AGEAcgBnAGUAdABMAG8AYwBhAHQAaQBvAG4AIAB0AG8AIABPADoAIABzAHUAYwBjAGUAcwBzAGYAdQBsAGwAeQAhACIADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgAGIAcgBlAGEAawANAAoAIAAgACAAIAAgACAAIAAgAH0AYwBhAHQAYwBoAHsADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgAFcAcgBpAHQAZQAtAEwAbwBnACAAIgBGAGEAaQBsAGUAZAAgAHQAbwAgAG0AYQBwACAAJAB0AGEAcgBnAGUAdABMAG8AYwBhAHQAaQBvAG4AIAB0AG8AIABPADoAIABiAGUAYwBhAHUAcwBlACAAbwBmACAAJABfACIADQAKACAAIAAgACAAIAAgACAAIAB9AA0ACgAgACAAIAAgAH0ADQAKACAAIAAgACAADQAKACAAIAAgACAAVwByAGkAdABlAC0ATABvAGcAIAAiAEQAaQBkACAAbgBvAHQAIABkAGUAdABlAGMAdAAgAHUAcwBlAHIAIABPAG4AZQBkAHIAaQB2AGUAIABmAG8AbABkAGUAcgAgAHUAbgBkAGUAcgAgACQAKAAkAGUAbgB2ADoAdQBzAGUAcgBwAHIAbwBmAGkAbABlACkALAAgAHQAcgB5AGkAbgBnACAAYQBnAGEAaQBuACAAaQBuACAAJAByAGUAdAByAHkAQQBmAHQAZQByAFMAZQBjAG8AbgBkAHMAIgANAAoAIAAgACAAIABTAHQAYQByAHQALQBTAGwAZQBlAHAAIAAtAFMAZQBjAG8AbgBkAHMAIAAkAHIAZQB0AHIAeQBBAGYAdABlAHIAUwBlAGMAbwBuAGQAcwANAAoAIAAgACAAIAAkAHIAZQB0AHIAeQBBAGYAdABlAHIAUwBlAGMAbwBuAGQAcwAgACsAPQAgADEAIAAjAGkAbgBjAHIAZQBhAHMAZQAgAHcAYQBpAHQAIAB0AGkAbQBlACAAYgB5ACAAbwBuAGUAIABzAGUAYwBvAG4AZAAgAGUAYQBjAGgAIAB0AGkAbQBlAA0ACgB9AA=='

$taskFolder = $SchedService.GetFolder("\")
$taskFolder.RegisterTaskDefinition($taskName, $Task , 6, 'Users', $null, 4)